## Criando uma chave de API

Conseguimos fazer a requisição para alterar algo no nosso gist, mas ela **foi rejeitada pelo GitHub**.

O erro com **status code 403** do HTTP, indica que o servidor entendeu o que queremos, mas se **recusa a autorizar**. Precisamos de uma autorização para provar que somos os proprietários do gist.

Para isso, **é essencial ler a documentação da API**.

Acesse a seção ["Update a gist"](https://docs.github.com/pt/rest/gists/gists?apiVersion=2022-11-28#update-a-gist) (Atualizar um gist) da documentação do Github

A **documentação é crucial**, seja para uma API de uma grande empresa ou qualquer outra. É nela que **aprendemos como o servidor espera que façamos requisições**, **quais são os padrões** e o que precisamos enviar para que ele entenda e execute o que desejamos.

Estamos na seção **"Update a gist"**, ou seja, atualizar um gist, que é exatamente o que queremos. **Não queremos criar um novo ou deletar**, apenas **adicionar algo novo ao existente**. Duas partes importantes são destacadas: a necessidade de tokens de acesso e a presença de exemplos na documentação.

O ponto de extremidade funciona com **tokens de acesso**, que podem ser de usuário ou refinados. Vamos criar um desses.

Lembrando que toda documentação de API **sempre terá exemplos de código**. Mas nem sempre elas estarão em Dart. Quando a linguagem desejada não está disponível, **o cURL é uma boa opção**, pois é **claro e direto**. É uma linguagem que podemos **usar em terminais**. No bloco de código que temos nesta seção, **ele indica que precisamos de um cabeçalho com a chave de autorização e o token**. Precisamos **gerar um token para autorização**, algo que não fizemos na primeira requisição, por isso não funcionou.

Exemplo em cURL para atualizar gist

```curl
curl -L \
  -X PATCH \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer <YOUR-TOKEN>" \
  -H "X-GitHub-Api-Version: 2022-11-28" \
  https://api.github.com/gists/GIST_ID \
  -d '{"description":"An updated gist description","files":{"README.md":{"content":"Hello World from GitHub"}}}'
```

### Criando o token

Para criar o token, vamos à **página inicial do GitHub**. No canto superior direito, clicamos na **foto de perfil** e acessamos **"Settings"** (Configurações). Na barra à esquerda, procuramos por **"Developer Settings"**. Em seguida, clicamos em **"Personal access tokens** > **Tokens (classic)"**

Na nova aba, clicamos em **"Generate New Token (classic)"**. Escolhemos a opção de **token clássico para uso geral**. Na tela de geração, precisamos prestar atenção em três partes:

- nome do token;
- tempo de expiração;
- escopos.

Para o nome, **colocamos algo identificável**, como "Curso gist". O **tempo de expiração** é uma **camada de segurança**. Podemos escolher "No Expiration" para não expirar, mas optamos por sete dias. Isso é útil, pois podemos mostrar o token sem preocupações, já que ele expirará antes de ser acessado por outras pessoas.

Devemos ter muito **cuidado ao compartilhar tokens** (chaves de API) com outras pessoas. Em geral, **alguém com esse código pode fazer alterações críticas**, seja no seu repositório ou em outras APIs.

Os **escopos** definem **como a API pode controlar o GitHub**. Selecionamos **apenas os gists** para garantir segurança. Mesmo que a chave vaze, sabemos que nossos repositórios estão seguros.

```
Note: curso-gist
Expiration: 7 days
Select scopes: gist
```

Após marcar gist, clicamos no botão **"Generate token"** (Gerar token).

Na página seguinte, o token gerado está sendo exibido. **São vários caracteres aleatórios**.

**É importante copiá-lo e guardá-lo em um local seguro**, pois ele não será exibido novamente.

Clicamos em copiar e colamos no nosso VSCode. Criamos um novo arquivo chamado `api_key.dart` dentro da pasta "lib" e declaramos uma `const string` chamada `github-api-key` com o token.

```dart
const String GitHubApiKey = "seu_token"
```

    Colocamos o token em um arquivo separado para que o controle de versionamento não o veja.

Agora, vamos acessar o arquivo `.gitignore`, que é um arquivo **onde colocamos o que queremos que seja ignorado pelo Git**. Ou seja, se subirmos todo o nosso repositório para o GitHub como público, a API Key não vai.

No arquivo `.gitignore`, adicionamos o caminho `lib/api_key.dart` para que **o git ignore esse arquivo**.

.gitignore
```gitignore
# https://dart.dev/guides/libraries/private-files
# Created by `dart pub`

.dart_tool/

lib/api_key.dart
```

Assim, ao subir o repositório para o GitHub, **a chave não será incluída**.
